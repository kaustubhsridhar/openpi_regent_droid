(openpi) (branch: main) ksridhar@ivy:~/openpi_regent_droid$ CUDA_VISIBLE_DEVICES=7 python scripts/test_pi0_fast_regent.py
11:52:01.655 [I] Loading model...                                                                 (3250503:policy_config.py:102)
INFO:2025-03-08 11:52:02,220:jax._src.xla_bridge:945: Unable to initialize backend 'rocm': module 'jaxlib.xla_extension' has no attribute 'GpuAllocatorConfig'
11:52:02.220 [I] Unable to initialize backend 'rocm': module 'jaxlib.xla_extension' has no attribute 'GpuAllocatorConfig' (3250503:xla_bridge.py:945)
INFO:2025-03-08 11:52:02,221:jax._src.xla_bridge:945: Unable to initialize backend 'tpu': INTERNAL: Failed to open libtpu.so: libtpu.so: cannot open shared object file: No such file or directory
11:52:02.221 [I] Unable to initialize backend 'tpu': INTERNAL: Failed to open libtpu.so: libtpu.so: cannot open shared object file: No such file or directory (3250503:xla_bridge.py:945)
11:52:02.235 [I] orbax-checkpoint version: 0.11.1                                                 (3250503:abstract_checkpointer.py:35)
11:52:02.235 [I] Created BasePyTreeCheckpointHandler: pytree_metadata_options=PyTreeMetadataOptions(support_rich_types=False), array_metadata_store=None (3250503:base_pytree_checkpoint_handler.py:332)
11:52:02.259 [I] Restoring checkpoint from /home/ksridhar/openpi_regent_droid/checkpoints/pi0_fast_droid_regent_with_interpolation/fourth_try_query_loss_only_with_interpolation/2000/params. (3250503:checkpointer.py:256)
11:52:11.208 [I] [thread=MainThread] Failed to get flag value for EXPERIMENTAL_ORBAX_USE_DISTRIBUTED_PROCESS_ID. (3250503:multihost.py:375)
11:52:11.209 [I] [process=0] /jax/checkpoint/read/bytes_per_sec: 629.0 MiB/s (total bytes: 5.5 GiB) (time elapsed: 8 seconds) (per-host) (3250503:base_pytree_checkpoint_handler.py:113)
11:52:11.210 [I] Finished restoring checkpoint from /home/ksridhar/openpi_regent_droid/checkpoints/pi0_fast_droid_regent_with_interpolation/fourth_try_query_loss_only_with_interpolation/2000/params. (3250503:checkpointer.py:259)
11:52:11.210 [I] [process=0][thread=MainThread] Skipping global process sync, barrier name: Checkpointer:restore (3250503:multihost.py:293)
Some kwargs in processor config are unused and will not have any effect: action_dim, min_token, time_horizon, scale, vocab_size. 
Some kwargs in processor config are unused and will not have any effect: action_dim, min_token, time_horizon, scale, vocab_size. 
11:52:13.673 [I] Loaded norm stats from /home/ksridhar/openpi_regent_droid/assets/pi0_fast_droid_regent_with_interpolation/droid (3250503:config.py:167)
11:52:13.675 [I] Loaded norm stats from checkpoints/pi0_fast_droid_regent_with_interpolation/fourth_try_query_loss_only_with_interpolation/2000/assets/droid (3250503:checkpoints.py:109)

11:52:13.678 [I] loading demos from regent_droid_preprocessing/collected_demos/2025-03-04...      (3250503:policy.py:119)

11:52:13.761 [I] building retrieval index...                                                      (3250503:policy.py:126)
11:52:13.762 [I] Using 8 omp threads (processes), consider increasing --nb_cores if you have more (3250503:quantize.py:193)
11:52:13.785 [I] Launching the whole pipeline 03/08/2025, 11:52:13                                (3250503:decorators.py:27)
11:52:13.785 [I] Reading total number of vectors and dimension 03/08/2025, 11:52:13               (3250503:decorators.py:27)
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 938.53it/s]
11:52:13.818 [I] There are 3158 embeddings of dim 2048                                            (3250503:quantize.py:213)
11:52:13.819 [I] >>> Finished "Reading total number of vectors and dimension" in 0.0335 secs      (3250503:decorators.py:38)
11:52:13.819 [I]        Compute estimated construction time of the index 03/08/2025, 11:52:13           (3250503:decorators.py:27)
11:52:13.819 [I]                -> Train: 16.7 minutes                                                         (3250503:quantize.py:217)
11:52:13.819 [I]                -> Add: 0.1 seconds                                                            (3250503:quantize.py:217)
11:52:13.819 [I]                Total: 16.7 minutes                                                            (3250503:quantize.py:217)
11:52:13.819 [I]        >>> Finished "Compute estimated construction time of the index" in 0.0002 secs  (3250503:decorators.py:38)
11:52:13.819 [I]        Checking that your have enough memory available to create the index 03/08/2025, 11:52:13 (3250503:decorators.py:27)
11:52:13.820 [I] 27.5MB of memory will be needed to build the index (more might be used if you have more) (3250503:quantize.py:223)
11:52:13.820 [I]        >>> Finished "Checking that your have enough memory available to create the index" in 0.0008 secs (3250503:decorators.py:38)
11:52:13.820 [I]        Selecting most promising index types given data characteristics 03/08/2025, 11:52:13 (3250503:decorators.py:27)
11:52:13.820 [I]        >>> Finished "Selecting most promising index types given data characteristics" in 0.0000 secs (3250503:decorators.py:38)
11:52:13.820 [I]        Creating the index 03/08/2025, 11:52:13                                         (3250503:decorators.py:27)
11:52:13.820 [I]                -> Instanciate the index HNSW15 03/08/2025, 11:52:13                           (3250503:decorators.py:27)
11:52:13.822 [I]                >>> Finished "-> Instanciate the index HNSW15" in 0.0015 secs                  (3250503:decorators.py:38)
11:52:13.822 [I]                -> Adding the vectors to the index 03/08/2025, 11:52:13                        (3250503:decorators.py:27)
11:52:13.822 [I] The memory available for adding the vectors is 50.0GB(total available - used by the index) (3250503:build.py:107)
11:52:13.822 [I] Using a batch size of 122070 (memory overhead 953.7MB)                           (3250503:build.py:88)
100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  6.36it/s]
11:52:13.982 [I]        Computing best hyperparameters for index knn.index 03/08/2025, 11:52:13         (3250503:decorators.py:27)
11:52:17.824 [I]        >>> Finished "Computing best hyperparameters for index knn.index" in 3.8415 secs (3250503:decorators.py:38)
11:52:17.824 [I] The best hyperparameters are: efSearch=16383                                     (3250503:optimize.py:563)
11:52:17.824 [I]        Compute fast metrics 03/08/2025, 11:52:17                                       (3250503:decorators.py:27)
  0%|                                                                                                                                                                  | 0/1 [00:00<?, ?it/s]
11:52:25.710 [I]        >>> Finished "Compute fast metrics" in 7.8859 secs                              (3250503:decorators.py:38)
11:52:25.710 [I]                >>> Finished "-> Adding the vectors to the index" in 11.8888 secs              (3250503:decorators.py:38)
11:52:25.711 [I] {                                                                                (3250503:quantize.py:36)
11:52:25.711 [I]        index_key: HNSW15                                                               (3250503:quantize.py:38)
11:52:25.711 [I]        index_param: efSearch=16383                                                     (3250503:quantize.py:38)
11:52:25.711 [I]        index_path: knn.index                                                           (3250503:quantize.py:38)
11:52:25.711 [I]        size in bytes: 26299262                                                         (3250503:quantize.py:38)
11:52:25.711 [I]        avg_search_speed_ms: 3.871013778494671                                          (3250503:quantize.py:38)
11:52:25.711 [I]        99p_search_speed_ms: 7.110027128364891                                          (3250503:quantize.py:38)
11:52:25.711 [I]        reconstruction error %: 0.0                                                     (3250503:quantize.py:38)
11:52:25.711 [I]        nb vectors: 3158                                                                (3250503:quantize.py:38)
11:52:25.711 [I]        vectors dimension: 2048                                                         (3250503:quantize.py:38)
11:52:25.711 [I]        compression ratio: 0.9836905689596918                                           (3250503:quantize.py:38)
11:52:25.711 [I] }                                                                                (3250503:quantize.py:39)
11:52:25.711 [I]        >>> Finished "Creating the index" in 11.8908 secs                               (3250503:decorators.py:38)
11:52:25.711 [I] >>> Finished "Launching the whole pipeline" in 11.9258 secs                      (3250503:decorators.py:38)

11:52:25.729 [I] retrieving...                                                                    (3250503:policy.py:200)
exp_lamda_distances: [[0.]
 [0.]
 [0.]
 [0.]
 [0.]]
11:52:30.875 [I] saving obs...                                                                    (3250503:policy.py:204)
11:52:31.008 [I] transforming...                                                                  (3250503:policy.py:207)
11:52:31.020 [I] saving tokenized inputs...                                                       (3250503:policy.py:212)
11:52:31.022 [I] batching...                                                                      (3250503:policy.py:215)
11:52:31.553 [I] sampling...                                                                      (3250503:policy.py:219)
query_prompt_len: 90
max_decoding_steps: 90
prefix_token_embeddings shape: (1, 4062, 2048)
prefix_attn_mask shape: (1, 4062, 4062)
prefix_attn_mask shape: (1, 4062, 4152)
prefix_positions shape: (1, 4062)
last_logit_old shape: (1, 1, 257152)
step: 0 / 90
full first_targets shape: (1, 90, 257152)
last_logit shape: (1, 1, 257152)
mask shape: (1, 1, 4152)
positions shape: (1, 1)
token_embedding shape: (1, 1, 2048)
last_logit_old shape: (1, 1, 257152)
step: Traced<ShapedArray(int32[], weak_type=True)>with<DynamicJaxprTrace> / 90
first_targets_slice shape: (1, 1, 257152)
last_logit shape: (1, 1, 257152)
11:52:51.823 [I] unbatching...                                                                    (3250503:policy.py:226)
decoded_tokens: Action: <loc0757><loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743><loc0689><loc0746>튿<loc0729><loc0624><loc0743>᠊튿<loc0729><loc0624><loc0743>᠊튿<loc0729><loc0624><loc0743>᠊<loc0714>|
raw_action_tokens: [256757 256729 256624 256743 256689 256746 255941 256729 256624 256743
 256689 256746 255941 256729 256624 256743 256689 256746 255941 256729
 256624 256743 256689 256746 255941 256729 256624 256743 256689 256746
 255941 256729 256624 256743 256689 256746 255941 256729 256624 256743
 256689 256746 255941 256729 256624 256743 255278 255941 256729 256624
 256743 255278 255941 256729 256624 256743 255278 256714]
action_tokens: [ 266  294  399  280  334  277 1082  294  399  280  334  277 1082  294
  399  280  334  277 1082  294  399  280  334  277 1082  294  399  280
  334  277 1082  294  399  280  334  277 1082  294  399  280  334  277
 1082  294  399  280 1745 1082  294  399  280 1745 1082  294  399  280
 1745  309]
outputs before normalization: [[-2.93381472e-01  1.76028883e+00 -8.80144416e-01 -2.93381472e-01
  -8.80144416e-01  4.10734061e+00  8.39025722e-01 -2.93381472e+00]
 [ 8.38768375e-02 -5.03261025e-01  2.51630512e-01  8.38768375e-02
   2.51630512e-01 -1.17427572e+00 -1.50976335e-01  8.38768375e-01]
 [-6.32455532e-02  3.79473319e-01 -1.89736660e-01 -6.32455532e-02
  -1.89736660e-01  8.85437745e-01  8.17697469e-02 -6.32455532e-01]
 [ 2.72272162e-02 -1.63363297e-01  8.16816486e-02  2.72272162e-02
   8.16816486e-02 -3.81181027e-01 -1.26502475e-02  2.72272162e-01]
 [-3.54430890e-02  2.12658534e-01 -1.06329267e-01 -3.54430890e-02
  -1.06329267e-01  4.96203247e-01  8.81858647e-02 -3.54430890e-01]
 [ 9.83572788e-03 -5.90143673e-02  2.95071836e-02  9.83572788e-03
   2.95071836e-02 -1.37700190e-01 -3.90031015e-02  9.83572788e-02]
 [-2.29647390e-02  1.37788434e-01 -6.88942170e-02 -2.29647390e-02
  -6.88942170e-02  3.21506346e-01  7.22234958e-02 -2.29647390e-01]
 [ 1.47451495e-17 -7.63278329e-17  3.81639165e-17  1.47451495e-17
   3.81639165e-17 -1.52655666e-16  1.85241937e-02  4.16333634e-17]
 [-1.46304211e-02  8.77825265e-02 -4.38912632e-02 -1.46304211e-02
  -4.38912632e-02  2.04825895e-01  1.55977654e-02 -1.46304211e-01]
 [-7.50227316e-03  4.50136390e-02 -2.25068195e-02 -7.50227316e-03
  -2.25068195e-02  1.05031824e-01  3.59861937e-02 -7.50227316e-02]]
final_outputs: {'query_actions': array([[-4.99799326e-02,  5.55056098e-01, -1.31458252e-01,
        -5.72626698e-02, -1.97516700e-01,  1.01530799e+00,
         2.30232496e-01, -8.47532464e-01],
       [ 8.48939967e-03, -1.37933817e-01,  3.94465536e-02,
         5.64437914e-02,  5.78117688e-02, -2.90540439e-01,
        -3.63743085e-02,  8.16805504e-01],
       [-1.43123458e-02,  1.32316912e-01, -2.72025377e-02,
         1.21007883e-02, -4.17606826e-02,  2.18711544e-01,
         2.63040351e-02,  1.67750534e-01],
       [-2.90434847e-04, -3.38735079e-02,  1.37832554e-02,
         3.93694744e-02,  1.94712984e-02, -9.44524617e-02,
         8.76802110e-04,  5.66886249e-01],
       [-1.00033843e-02,  8.12462611e-02, -1.46075210e-02,
         2.04805104e-02, -2.29439716e-02,  1.22475615e-01,
         2.80318908e-02,  2.90405743e-01],
       [-2.98585250e-03, -1.92689288e-03,  5.90459814e-03,
         3.41276427e-02,  7.70073705e-03, -3.42532639e-02,
        -6.22000152e-03,  4.90160797e-01],
       [-8.06942879e-03,  5.83246435e-02, -8.95460379e-03,
         2.42415118e-02, -1.44986228e-02,  7.92828384e-02,
         2.37332369e-02,  3.45456066e-01],
       [-4.51024157e-03,  1.61404632e-02,  1.44883636e-03,
         3.11631333e-02,  1.04391526e-03, -2.07705610e-04,
         9.27205552e-03,  4.46768843e-01],
       [-6.77773556e-03,  4.30152437e-02, -5.17900774e-03,
         2.67534931e-02, -8.85795545e-03,  5.04342865e-02,
         8.48397059e-03,  3.82224299e-01],
       [-5.67298044e-03,  2.99214708e-02, -1.94982842e-03,
         2.89019321e-02, -4.03362410e-03,  2.57607922e-02,
         1.39745589e-02,  4.13671313e-01]])}
(openpi) (branch: main) ksridhar@ivy:~/openpi_regent_droid$ 