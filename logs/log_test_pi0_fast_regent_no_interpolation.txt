(openpi) (branch: main) ksridhar@ivy:~/openpi_regent_droid$ CUDA_VISIBLE_DEVICES=8 python scripts/test_pi0_fast_regent_no_interpolation.py
11:52:20.060 [I] Loading model...                                                                 (3251151:policy_config.py:102)
INFO:2025-03-08 11:52:20,645:jax._src.xla_bridge:945: Unable to initialize backend 'rocm': module 'jaxlib.xla_extension' has no attribute 'GpuAllocatorConfig'
11:52:20.645 [I] Unable to initialize backend 'rocm': module 'jaxlib.xla_extension' has no attribute 'GpuAllocatorConfig' (3251151:xla_bridge.py:945)
INFO:2025-03-08 11:52:20,646:jax._src.xla_bridge:945: Unable to initialize backend 'tpu': INTERNAL: Failed to open libtpu.so: libtpu.so: cannot open shared object file: No such file or directory
11:52:20.646 [I] Unable to initialize backend 'tpu': INTERNAL: Failed to open libtpu.so: libtpu.so: cannot open shared object file: No such file or directory (3251151:xla_bridge.py:945)
11:52:20.661 [I] orbax-checkpoint version: 0.11.1                                                 (3251151:abstract_checkpointer.py:35)
11:52:20.661 [I] Created BasePyTreeCheckpointHandler: pytree_metadata_options=PyTreeMetadataOptions(support_rich_types=False), array_metadata_store=None (3251151:base_pytree_checkpoint_handler.py:332)
11:52:20.692 [I] Restoring checkpoint from /home/ksridhar/openpi_regent_droid/checkpoints/pi0_fast_droid_regent/fourth_try_query_loss_only/2000/params. (3251151:checkpointer.py:256)
11:52:28.535 [I] [thread=MainThread] Failed to get flag value for EXPERIMENTAL_ORBAX_USE_DISTRIBUTED_PROCESS_ID. (3251151:multihost.py:375)
11:52:28.537 [I] [process=0] /jax/checkpoint/read/bytes_per_sec: 717.8 MiB/s (total bytes: 5.5 GiB) (time elapsed: 7 seconds) (per-host) (3251151:base_pytree_checkpoint_handler.py:113)
11:52:28.537 [I] Finished restoring checkpoint from /home/ksridhar/openpi_regent_droid/checkpoints/pi0_fast_droid_regent/fourth_try_query_loss_only/2000/params. (3251151:checkpointer.py:259)
11:52:28.537 [I] [process=0][thread=MainThread] Skipping global process sync, barrier name: Checkpointer:restore (3251151:multihost.py:293)
Some kwargs in processor config are unused and will not have any effect: time_horizon, vocab_size, scale, action_dim, min_token. 
Some kwargs in processor config are unused and will not have any effect: time_horizon, vocab_size, scale, action_dim, min_token. 
11:52:30.881 [I] Loaded norm stats from /home/ksridhar/openpi_regent_droid/assets/pi0_fast_droid_regent/droid (3251151:config.py:167)
11:52:30.884 [I] Loaded norm stats from checkpoints/pi0_fast_droid_regent/fourth_try_query_loss_only/2000/assets/droid (3251151:checkpoints.py:109)

11:52:30.887 [I] loading demos from regent_droid_preprocessing/collected_demos/2025-03-04...      (3251151:policy.py:119)

11:52:30.942 [I] building retrieval index...                                                      (3251151:policy.py:126)
11:52:30.943 [I] Using 8 omp threads (processes), consider increasing --nb_cores if you have more (3251151:quantize.py:193)
11:52:30.963 [I] Launching the whole pipeline 03/08/2025, 11:52:30                                (3251151:decorators.py:27)
11:52:30.964 [I] Reading total number of vectors and dimension 03/08/2025, 11:52:30               (3251151:decorators.py:27)
100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00, 934.35it/s]
11:52:31.005 [I] There are 3158 embeddings of dim 2048                                            (3251151:quantize.py:213)
11:52:31.005 [I] >>> Finished "Reading total number of vectors and dimension" in 0.0411 secs      (3251151:decorators.py:38)
11:52:31.005 [I]        Compute estimated construction time of the index 03/08/2025, 11:52:31           (3251151:decorators.py:27)
11:52:31.005 [I]                -> Train: 16.7 minutes                                                         (3251151:quantize.py:217)
11:52:31.005 [I]                -> Add: 0.1 seconds                                                            (3251151:quantize.py:217)
11:52:31.005 [I]                Total: 16.7 minutes                                                            (3251151:quantize.py:217)
11:52:31.005 [I]        >>> Finished "Compute estimated construction time of the index" in 0.0001 secs  (3251151:decorators.py:38)
11:52:31.005 [I]        Checking that your have enough memory available to create the index 03/08/2025, 11:52:31 (3251151:decorators.py:27)
11:52:31.006 [I] 27.5MB of memory will be needed to build the index (more might be used if you have more) (3251151:quantize.py:223)
11:52:31.006 [I]        >>> Finished "Checking that your have enough memory available to create the index" in 0.0006 secs (3251151:decorators.py:38)
11:52:31.006 [I]        Selecting most promising index types given data characteristics 03/08/2025, 11:52:31 (3251151:decorators.py:27)
11:52:31.006 [I]        >>> Finished "Selecting most promising index types given data characteristics" in 0.0000 secs (3251151:decorators.py:38)
11:52:31.006 [I]        Creating the index 03/08/2025, 11:52:31                                         (3251151:decorators.py:27)
11:52:31.006 [I]                -> Instanciate the index HNSW15 03/08/2025, 11:52:31                           (3251151:decorators.py:27)
11:52:31.008 [I]                >>> Finished "-> Instanciate the index HNSW15" in 0.0022 secs                  (3251151:decorators.py:38)
11:52:31.008 [I]                -> Adding the vectors to the index 03/08/2025, 11:52:31                        (3251151:decorators.py:27)
11:52:31.008 [I] The memory available for adding the vectors is 50.0GB(total available - used by the index) (3251151:build.py:107)
11:52:31.008 [I] Using a batch size of 122070 (memory overhead 953.7MB)                           (3251151:build.py:88)
100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 1/1 [00:00<00:00,  8.20it/s]
11:52:31.133 [I]        Computing best hyperparameters for index knn.index 03/08/2025, 11:52:31         (3251151:decorators.py:27)
11:52:35.009 [I]        >>> Finished "Computing best hyperparameters for index knn.index" in 3.8758 secs (3251151:decorators.py:38)
11:52:35.010 [I] The best hyperparameters are: efSearch=16383                                     (3251151:optimize.py:563)
11:52:35.010 [I]        Compute fast metrics 03/08/2025, 11:52:35                                       (3251151:decorators.py:27)
  0%|                                                                                                                                                            | 0/1 [00:00<?, ?it/s]
11:52:40.559 [I]        >>> Finished "Compute fast metrics" in 5.5489 secs                              (3251151:decorators.py:38)
11:52:40.559 [I]                >>> Finished "-> Adding the vectors to the index" in 9.5506 secs               (3251151:decorators.py:38)
11:52:40.559 [I] {                                                                                (3251151:quantize.py:36)
11:52:40.559 [I]        index_key: HNSW15                                                               (3251151:quantize.py:38)
11:52:40.559 [I]        index_param: efSearch=16383                                                     (3251151:quantize.py:38)
11:52:40.559 [I]        index_path: knn.index                                                           (3251151:quantize.py:38)
11:52:40.559 [I]        size in bytes: 26299262                                                         (3251151:quantize.py:38)
11:52:40.559 [I]        avg_search_speed_ms: 2.7293672208907083                                         (3251151:quantize.py:38)
11:52:40.559 [I]        99p_search_speed_ms: 4.500492080114782                                          (3251151:quantize.py:38)
11:52:40.559 [I]        reconstruction error %: 0.0                                                     (3251151:quantize.py:38)
11:52:40.559 [I]        nb vectors: 3158                                                                (3251151:quantize.py:38)
11:52:40.559 [I]        vectors dimension: 2048                                                         (3251151:quantize.py:38)
11:52:40.559 [I]        compression ratio: 0.9836905689596918                                           (3251151:quantize.py:38)
11:52:40.559 [I] }                                                                                (3251151:quantize.py:39)
11:52:40.559 [I]        >>> Finished "Creating the index" in 9.5533 secs                                (3251151:decorators.py:38)
11:52:40.559 [I] >>> Finished "Launching the whole pipeline" in 9.5955 secs                       (3251151:decorators.py:38)

11:52:40.577 [I] retrieving...                                                                    (3251151:policy.py:200)
11:52:45.100 [I] saving obs...                                                                    (3251151:policy.py:204)
11:52:45.183 [I] transforming...                                                                  (3251151:policy.py:207)
11:52:45.192 [I] saving tokenized inputs...                                                       (3251151:policy.py:212)
11:52:45.194 [I] batching...                                                                      (3251151:policy.py:215)
11:52:45.601 [I] sampling...                                                                      (3251151:policy.py:219)
query_prompt_len: 90
max_decoding_steps: 90
prefix_token_embeddings shape: (1, 4062, 2048)
prefix_attn_mask shape: (1, 4062, 4062)
prefix_attn_mask shape: (1, 4062, 4152)
prefix_positions shape: (1, 4062)
last_logit_old shape: (1, 1, 257152)
last_logit shape: (1, 1, 257152)
mask shape: (1, 1, 4152)
positions shape: (1, 1)
token_embedding shape: (1, 1, 2048)
last_logit_old shape: (1, 1, 257152)
last_logit shape: (1, 1, 257152)
11:53:04.013 [I] unbatching...                                                                    (3251151:policy.py:226)
decoded_tokens: Action: <loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777><loc0758><loc0678><loc0755><loc0777>|
raw_action_tokens: [256758 256678 256755 256777 256758 256678 256755 256777 256758 256678
 256755 256777 256758 256678 256755 256777 256758 256678 256755 256777
 256758 256678 256755 256777 256758 256678 256755 256777 256758 256678
 256755 256777 256758 256678 256755 256777 256758 256678 256755 256777]
action_tokens: [265 345 268 246 265 345 268 246 265 345 268 246 265 345 268 246 265 345
 268 246 265 345 268 246 265 345 268 246 265 345 268 246 265 345 268 246
 265 345 268 246]
outputs before normalization: [[ 2.93381472e-01  0.00000000e+00 -2.93381472e-01 -2.93381472e-01
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -2.93381472e+00]
 [-8.38768375e-02  0.00000000e+00  8.38768375e-02  8.38768375e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00  8.38768375e-01]
 [ 6.32455532e-02  0.00000000e+00 -6.32455532e-02 -6.32455532e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -6.32455532e-01]
 [-2.72272162e-02  0.00000000e+00  2.72272162e-02  2.72272162e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00  2.72272162e-01]
 [ 3.54430890e-02  0.00000000e+00 -3.54430890e-02 -3.54430890e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -3.54430890e-01]
 [-9.83572788e-03  0.00000000e+00  9.83572788e-03  9.83572788e-03
   0.00000000e+00  0.00000000e+00  0.00000000e+00  9.83572788e-02]
 [ 2.29647390e-02  0.00000000e+00 -2.29647390e-02 -2.29647390e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -2.29647390e-01]
 [-1.47451495e-17  0.00000000e+00  1.47451495e-17  1.47451495e-17
   0.00000000e+00  0.00000000e+00  0.00000000e+00  4.16333634e-17]
 [ 1.46304211e-02  0.00000000e+00 -1.46304211e-02 -1.46304211e-02
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -1.46304211e-01]
 [ 7.50227316e-03  0.00000000e+00 -7.50227316e-03 -7.50227316e-03
   0.00000000e+00  0.00000000e+00  0.00000000e+00 -7.50227316e-02]]
final_outputs: {'query_actions': array([[ 4.09594494e-02,  1.61404632e-02, -4.28535263e-02,
        -5.72626698e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03, -8.47532464e-01],
       [-1.75098828e-02,  1.61404632e-02,  1.41147421e-02,
         5.64437914e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  8.16805504e-01],
       [ 5.29186264e-03,  1.61404632e-02, -8.10162166e-03,
         1.21007883e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  1.67750534e-01],
       [-8.73004828e-03,  1.61404632e-02,  5.56030938e-03,
         3.93694744e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  5.66886249e-01],
       [ 9.82901186e-04,  1.61404632e-02, -3.90328275e-03,
         2.04805104e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  2.90405743e-01],
       [-6.03463063e-03,  1.61404632e-02,  2.93409029e-03,
         3.41276427e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  4.90160797e-01],
       [-9.51054342e-04,  1.61404632e-02, -2.01897702e-03,
         2.42415118e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  3.45456066e-01],
       [-4.51024157e-03,  1.61404632e-02,  1.44883636e-03,
         3.11631333e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  4.46768843e-01],
       [-2.24274757e-03,  1.61404632e-02, -7.60445005e-04,
         2.67534931e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  3.82224299e-01],
       [-3.34750269e-03,  1.61404632e-02,  3.15948101e-04,
         2.89019321e-02,  1.04391526e-03, -2.07705610e-04,
         4.28350419e-03,  4.13671313e-01]])}
(openpi) (branch: main) ksridhar@ivy:~/openpi_regent_droid$ 